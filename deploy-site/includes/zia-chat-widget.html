<!-- Zia AI Chat Widget - Trained Success Chemistry assistant. Include once per page (e.g. before </body>). -->
<div id="zia-chat-root" aria-hidden="false">
  <button type="button" id="zia-chat-toggle" class="zia-chat-toggle" aria-label="Open chat">
    <span class="zia-chat-bot-avatar">
      <span class="zia-chat-bot-eye left"></span>
      <span class="zia-chat-bot-eye right"></span>
      <span class="zia-chat-bot-smile"></span>
    </span>
    <span class="zia-chat-pulse"></span>
  </button>
  <div id="zia-chat-panel" class="zia-chat-panel" hidden>
    <div class="zia-chat-header">
      <div class="zia-chat-header-avatar">
        <span class="zia-chat-bot-eye left"></span>
        <span class="zia-chat-bot-eye right"></span>
        <span class="zia-chat-bot-smile"></span>
      </div>
      <div class="zia-chat-header-text">
        <strong>Success Chemistry</strong>
        <span>Ask me about products, orders & more</span>
      </div>
      <button type="button" id="zia-chat-close" class="zia-chat-close" aria-label="Close chat">&times;</button>
    </div>
    <div id="zia-chat-messages" class="zia-chat-messages"></div>
    <div class="zia-chat-input-wrap">
      <input type="text" id="zia-chat-input" class="zia-chat-input" placeholder="Ask about products, shipping, or support..." maxlength="500" autocomplete="off">
      <button type="button" id="zia-chat-send" class="zia-chat-send" aria-label="Send">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
      </button>
    </div>
  </div>
</div>
<style>
  #zia-chat-root { --zia-bg: #0a0e1a; --zia-card: rgba(255,255,255,0.08); --zia-border: rgba(255,255,255,0.12); --zia-text: rgba(255,255,255,0.95); --zia-muted: rgba(255,255,255,0.6); --zia-accent: #06b6d4; --zia-accent-dim: rgba(6,182,212,0.4); }
  .zia-chat-toggle { position: fixed; bottom: 24px; right: 24px; z-index: 99998; width: 60px; height: 60px; border-radius: 50%; border: none; cursor: pointer; background: linear-gradient(145deg, var(--zia-accent), #0891b2); box-shadow: 0 4px 20px var(--zia-accent-dim); display: flex; align-items: center; justify-content: center; transition: transform 0.2s, box-shadow 0.2s; }
  .zia-chat-toggle:hover { transform: scale(1.05); box-shadow: 0 6px 28px var(--zia-accent-dim); }
  .zia-chat-pulse { position: absolute; inset: -4px; border-radius: 50%; border: 2px solid var(--zia-accent); animation: zia-pulse 2s ease-out infinite; opacity: 0.6; }
  @keyframes zia-pulse { 0% { transform: scale(1); opacity: 0.6; } 100% { transform: scale(1.3); opacity: 0; } }
  .zia-chat-bot-avatar { position: relative; width: 28px; height: 24px; }
  .zia-chat-bot-eye, .zia-chat-header-avatar .zia-chat-bot-eye { width: 6px; height: 6px; background: #fff; border-radius: 50%; position: absolute; top: 4px; animation: zia-blink 3s ease-in-out infinite; }
  .zia-chat-bot-eye.left { left: 4px; }
  .zia-chat-bot-eye.right { right: 4px; }
  .zia-chat-bot-smile { position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%); width: 14px; height: 6px; border: 2px solid #fff; border-top: none; border-radius: 0 0 10px 10px; }
  @keyframes zia-blink { 0%, 45%, 55%, 100% { transform: scaleY(1); } 50% { transform: scaleY(0.1); } }
  .zia-chat-panel { position: fixed; bottom: 90px; right: 24px; width: 380px; max-width: calc(100vw - 48px); height: 520px; max-height: 80vh; z-index: 99997; background: var(--zia-bg); border: 1px solid var(--zia-border); border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); display: flex; flex-direction: column; overflow: hidden; animation: zia-slideUp 0.3s ease; }
  @keyframes zia-slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  .zia-chat-panel[hidden] { display: none !important; }
  .zia-chat-header { display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--zia-card); border-bottom: 1px solid var(--zia-border); }
  .zia-chat-header-avatar { width: 40px; height: 36px; position: relative; flex-shrink: 0; }
  .zia-chat-header-avatar .zia-chat-bot-eye { width: 8px; height: 8px; top: 2px; }
  .zia-chat-header-avatar .zia-chat-bot-eye.left { left: 2px; }
  .zia-chat-header-avatar .zia-chat-bot-eye.right { right: 2px; }
  .zia-chat-header-avatar .zia-chat-bot-smile { width: 18px; height: 8px; bottom: 0; }
  .zia-chat-header-text { flex: 1; min-width: 0; }
  .zia-chat-header-text strong { display: block; color: var(--zia-text); font-size: 1rem; }
  .zia-chat-header-text span { font-size: 0.8rem; color: var(--zia-muted); }
  .zia-chat-close { width: 36px; height: 36px; border: none; background: transparent; color: var(--zia-muted); font-size: 1.5rem; cursor: pointer; border-radius: 8px; line-height: 1; }
  .zia-chat-close:hover { color: var(--zia-text); background: var(--zia-card); }
  .zia-chat-messages { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 12px; }
  .zia-msg { max-width: 85%; padding: 12px 16px; border-radius: 16px; font-size: 0.9rem; line-height: 1.45; }
  .zia-msg.user { align-self: flex-end; background: linear-gradient(135deg, var(--zia-accent), #0891b2); color: #fff; }
  .zia-msg.bot { align-self: flex-start; background: var(--zia-card); border: 1px solid var(--zia-border); color: var(--zia-text); }
  .zia-msg.typing { opacity: 0.8; }
  .zia-chat-input-wrap { display: flex; gap: 8px; padding: 12px 16px; border-top: 1px solid var(--zia-border); background: var(--zia-bg); }
  .zia-chat-input { flex: 1; padding: 12px 16px; border: 1px solid var(--zia-border); border-radius: 24px; background: var(--zia-card); color: var(--zia-text); font-size: 0.9rem; outline: none; }
  .zia-chat-input::placeholder { color: var(--zia-muted); }
  .zia-chat-input:focus { border-color: var(--zia-accent); box-shadow: 0 0 0 2px var(--zia-accent-dim); }
  .zia-chat-send { width: 44px; height: 44px; border-radius: 50%; border: none; background: linear-gradient(145deg, var(--zia-accent), #0891b2); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; }
  .zia-chat-send:hover { transform: scale(1.05); }
  .zia-chat-send:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
  @media (max-width: 480px) { .zia-chat-panel { right: 12px; bottom: 80px; width: calc(100vw - 24px); } .zia-chat-toggle { right: 12px; bottom: 16px; } }
</style>
<script>
(function() {
  var root = document.getElementById('zia-chat-root');
  var toggle = document.getElementById('zia-chat-toggle');
  var panel = document.getElementById('zia-chat-panel');
  var closeBtn = document.getElementById('zia-chat-close');
  var messages = document.getElementById('zia-chat-messages');
  var input = document.getElementById('zia-chat-input');
  var sendBtn = document.getElementById('zia-chat-send');

  var STORAGE_KEY = 'zia_chat_sessionId';
  var API_BASE = (typeof window.ZIA_CHAT_API_BASE !== 'undefined' ? window.ZIA_CHAT_API_BASE : '');

  function getSessionId() { try { return sessionStorage.getItem(STORAGE_KEY); } catch (e) { return null; } }
  function setSessionId(id) { try { if (id) sessionStorage.setItem(STORAGE_KEY, id); } catch (e) {} }

  function openPanel() { panel.removeAttribute('hidden'); toggle.setAttribute('aria-label', 'Close chat'); }
  function closePanel() { panel.setAttribute('hidden', ''); toggle.setAttribute('aria-label', 'Open chat'); }
  function isOpen() { return !panel.hasAttribute('hidden'); }

  toggle.addEventListener('click', function() { if (isOpen()) closePanel(); else openPanel(); });
  closeBtn.addEventListener('click', closePanel);

  function addMessage(text, isUser) {
    var div = document.createElement('div');
    div.className = 'zia-msg ' + (isUser ? 'user' : 'bot');
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function setTyping(on) {
    var existing = document.querySelector('.zia-msg.typing');
    if (existing) existing.remove();
    if (on) {
      var t = document.createElement('div');
      t.className = 'zia-msg bot typing';
      t.textContent = '…';
      messages.appendChild(t);
      messages.scrollTop = messages.scrollHeight;
    }
  }

  function send() {
    var msg = (input.value || '').trim();
    if (!msg) return;
    input.value = '';
    addMessage(msg, true);
    setTyping(true);
    sendBtn.disabled = true;

    var sessionId = getSessionId();
    fetch(API_BASE + '/api/zia/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: msg, sessionId: sessionId || undefined })
    })
      .then(function(r) { return r.json(); })
      .then(function(data) {
        setTyping(false);
        if (data.success && data.response) {
          addMessage(data.response, false);
          if (data.sessionId) setSessionId(data.sessionId);
        } else {
          addMessage('Sorry, I couldn’t get a response right now. Please try again or email us at info@successchemistry.com.', false);
        }
      })
      .catch(function() {
        setTyping(false);
        addMessage('Connection issue. Please check your network or try again later.', false);
      })
      .then(function() { sendBtn.disabled = false; });
  }

  sendBtn.addEventListener('click', send);
  input.addEventListener('keydown', function(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); } });

  if (messages.children.length === 0) {
    addMessage('Hi! I’m your Success Chemistry assistant. Ask me about our supplements, shipping, or anything else.', false);
  }
})();
</script>
