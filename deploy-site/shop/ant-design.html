<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Supplements - Success Chemistry | Ant Design</title>
    <meta name="description" content="Shop premium quality supplements and vitamins from Success Chemistry. Built with Ant Design components.">
    
    <!-- Ant Design CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.css">
    
    <!-- Ant Design Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ant-design/icons@5.2.6/lib/index.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #f0f2f5;
            color: rgba(0, 0, 0, 0.88);
        }
        
        .ant-layout {
            min-height: 100vh;
        }
        
        .ant-layout-header {
            background: #001529;
            padding: 0 24px;
            height: 64px;
            line-height: 64px;
        }
        
        .shop-header {
            background: #ffffff;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .shop-title {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 8px;
            color: rgba(0, 0, 0, 0.88);
        }
        
        .shop-subtitle {
            color: rgba(0, 0, 0, 0.45);
            font-size: 14px;
        }
        
        .category-section {
            background: #ffffff;
            padding: 24px;
            margin-bottom: 24px;
            border-radius: 8px;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .category-card {
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #f0f0f0;
        }
        
        .category-card:hover {
            border-color: #1677ff;
            box-shadow: 0 2px 8px rgba(22, 119, 255, 0.15);
        }
        
        .category-card.active {
            border-color: #1677ff;
            box-shadow: 0 2px 8px rgba(22, 119, 255, 0.3);
        }
        
        .category-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        
        .category-info {
            padding: 12px;
            text-align: center;
        }
        
        .category-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .category-count {
            font-size: 12px;
            color: rgba(0, 0, 0, 0.45);
        }
        
        .filters-section {
            background: #ffffff;
            padding: 24px;
            margin-bottom: 24px;
            border-radius: 8px;
        }
        
        .products-section {
            background: #ffffff;
            padding: 24px;
            border-radius: 8px;
        }
        
        .product-card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .product-image-container {
            width: 100%;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            margin-bottom: 16px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .product-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .product-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            min-height: 48px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .product-price {
            font-size: 20px;
            font-weight: 600;
            color: #1677ff;
            margin-bottom: 12px;
        }
        
        .product-actions {
            margin-top: auto;
        }
        
        .loading-container {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-container {
            text-align: center;
            padding: 60px 20px;
        }
        
        .stats-section {
            background: linear-gradient(135deg, #1677ff 0%, #722ed1 100%);
            color: #ffffff;
            padding: 48px 24px;
            margin-top: 24px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stats-number {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .stats-label {
            font-size: 16px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <div class="ant-layout-header" style="display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 24px;">
                <a href="/" style="color: #ffffff; text-decoration: none; font-size: 18px; font-weight: 600;">
                    Success Chemistry
                </a>
                <a href="/shop" style="color: rgba(255, 255, 255, 0.85); text-decoration: none;">Shop</a>
                <a href="/cart" style="color: rgba(255, 255, 255, 0.85); text-decoration: none;">Cart</a>
            </div>
            <div>
                <span id="cartCount" style="color: rgba(255, 255, 255, 0.85);">Cart (0)</span>
            </div>
        </div>

        <div style="max-width: 1400px; margin: 0 auto; padding: 24px;">
            <!-- Shop Header -->
            <div class="shop-header">
                <h1 class="shop-title">Shop Supplements</h1>
                <p class="shop-subtitle">Premium quality vitamins and health supplements for your wellness journey</p>
            </div>

            <!-- Category Filters -->
            <div class="category-section">
                <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 16px;">Shop by Category</h2>
                <div class="category-grid" id="categoryGrid">
                    <!-- Categories will be loaded here -->
                </div>
            </div>

            <!-- Search and Sort Filters -->
            <div class="filters-section">
                <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
                    <div style="flex: 1; min-width: 250px;">
                        <input 
                            type="text" 
                            id="searchInput" 
                            placeholder="Search products..." 
                            style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px; font-size: 14px;"
                            onkeyup="handleSearch(this.value)"
                        />
                    </div>
                    <div style="min-width: 200px;">
                        <select 
                            id="sortSelect" 
                            onchange="handleSort(this.value)"
                            style="width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 6px; font-size: 14px; background: #ffffff;"
                        >
                            <option value="sales">Sort by: Best Sellers</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="name">Name: A to Z</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="products-section">
                <div id="productsContainer" class="loading-container">
                    <div>Loading products...</div>
                </div>
                <div id="paginationContainer" style="margin-top: 24px; text-align: center; display: none;"></div>
            </div>

            <!-- Stats Section -->
            <div class="stats-section">
                <div class="stats-number">50,000+</div>
                <div class="stats-label">Happy Customers Trust Success Chemistry</div>
            </div>
        </div>
    </div>

    <!-- Load cart utilities -->
    <script src="/public/cart-utils.js" type="text/javascript"></script>
    <script src="/products-data.js?v=29" type="text/javascript"></script>
    
    <!-- Ant Design JS -->
    <script src="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/antd.min.js"></script>
    
    <script>
        // Variables
        let allProducts = [];
        let filteredProducts = [];
        let currentPage = 1;
        const productsPerPage = 20;
        let currentCategory = 'all';
        let currentSort = 'sales';
        let searchQuery = '';
        
        // Categories configuration
        const categories = [
            { id: 'all', name: 'All Products', image: '/images/Catagory Thumbnail Images/Best sellers Catagory image.jpg' },
            { id: 'bestsellers', name: 'Best Sellers', image: '/images/Catagory Thumbnail Images/Best sellers Catagory image.jpg' },
            { id: 'mens', name: "Men's Health", image: '/images/Catagory Thumbnail Images/mens health catagory thumb.webp' },
            { id: 'womens', name: "Women's Health", image: '/images/Catagory Thumbnail Images/womens health thumb.webp' },
            { id: 'eye', name: 'Eye Health', image: '/images/Catagory Thumbnail Images/OPZ-eyeBeautiful-lashes__94531.1721847264.jpg' },
            { id: 'weight', name: 'Weight Loss', image: '/images/Catagory Thumbnail Images/weight loss catagory thumb.webp' },
            { id: 'bundles', name: 'Bundle Deals', image: '/images/Catagory Thumbnail Images/Bundle Deals.webp' },
            { id: 'unisex', name: 'Unisex', image: '/images/Catagory Thumbnail Images/unisex thumb.webp' },
            { id: 'legacy', name: 'Legacy', image: '/images/Catagory Thumbnail Images/legacy cat thumb.jpg' }
        ];
        
        // Initialize
        function init() {
            renderCategories();
            
            // Wait for products-data.js to load
            if (typeof window.getAllProducts === 'function') {
                loadProducts();
            } else {
                // Poll for products data
                const checkInterval = setInterval(() => {
                    if (typeof window.getAllProducts === 'function') {
                        clearInterval(checkInterval);
                        loadProducts();
                    }
                }, 100);
                
                // Timeout after 10 seconds
                setTimeout(() => {
                    clearInterval(checkInterval);
                    if (allProducts.length === 0) {
                        document.getElementById('productsContainer').innerHTML = 
                            '<div class="empty-container"><div>Error loading products. Please refresh the page.</div></div>';
                    }
                }, 10000);
            }
            
            updateCartCount();
        }
        
        // Render categories
        function renderCategories() {
            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = categories.map(cat => `
                <div class="category-card ${cat.id === currentCategory ? 'active' : ''}" 
                     onclick="filterByCategory('${cat.id}')">
                    <img src="${cat.image}" alt="${cat.name}" class="category-image" 
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22120%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22200%22 height=%22120%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3E${cat.name}%3C/text%3E%3C/svg%3E'">
                    <div class="category-info">
                        <div class="category-name">${cat.name}</div>
                        <div class="category-count" id="count-${cat.id}">-</div>
                    </div>
                </div>
            `).join('');
        }
        
        // Load products
        function loadProducts() {
            if (typeof window.getAllProducts !== 'function') {
                return;
            }
            
            // Get all products (already an array from getAllProducts)
            const products = window.getAllProducts();
            
            // Map to expected structure
            allProducts = products.map(product => {
                return {
                    sku: product.sku,
                    title: product.name,
                    price: product.price || 0,
                    image: (product.images && product.images[0]) || '/images/placeholder.png',
                    categories: product.category || '',
                    description: product.description || product.short_description || '',
                    bestseller: product.bestseller || false,
                    featured: product.featured || false
                };
            }).filter(p => {
                // Filter out hidden SKUs and ensure product has required fields
                const hiddenSKUs = ['21884-502', '20647-507-3', '10786-807-2', '10786-807-3'];
                return p && p.sku && !hiddenSKUs.includes(p.sku);
            });
            
            filterProducts();
            updateCategoryCounts();
        }
        
        // Update category counts
        function updateCategoryCounts() {
            categories.forEach(cat => {
                if (cat.id === 'all') {
                    document.getElementById('count-all').textContent = `${allProducts.length} Products`;
                } else {
                    const count = allProducts.filter(p => {
                        const categories = (p.categories || '').toLowerCase();
                        return categories.includes(cat.id) || 
                               (cat.id === 'bestsellers' && (p.bestseller || p.featured));
                    }).length;
                    const countEl = document.getElementById(`count-${cat.id}`);
                    if (countEl) countEl.textContent = `${count} Products`;
                }
            });
        }
        
        // Filter products
        function filterProducts() {
            filteredProducts = [...allProducts];
            
            // Filter by category
            if (currentCategory !== 'all') {
                filteredProducts = filteredProducts.filter(p => {
                    const categories = (p.categories || '').toLowerCase();
                    if (currentCategory === 'bestsellers') {
                        return p.bestseller || p.featured;
                    }
                    return categories.includes(currentCategory);
                });
            }
            
            // Filter by search
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filteredProducts = filteredProducts.filter(p => {
                    const title = (p.title || '').toLowerCase();
                    const description = (p.description || '').toLowerCase();
                    const sku = (p.sku || '').toLowerCase();
                    return title.includes(query) || description.includes(query) || sku.includes(query);
                });
            }
            
            // Sort products
            sortProducts();
            
            // Render
            renderProducts();
            renderPagination();
        }
        
        // Sort products
        function sortProducts() {
            switch(currentSort) {
                case 'price-low':
                    filteredProducts.sort((a, b) => (a.price || 0) - (b.price || 0));
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => (b.price || 0) - (a.price || 0));
                    break;
                case 'name':
                    filteredProducts.sort((a, b) => (a.title || '').localeCompare(b.title || ''));
                    break;
                case 'sales':
                default:
                    // Keep original order (already sorted by sales)
                    break;
            }
        }
        
        // Render products
        function renderProducts() {
            const container = document.getElementById('productsContainer');
            
            if (filteredProducts.length === 0) {
                container.innerHTML = `
                    <div class="empty-container">
                        <div style="font-size: 16px; color: rgba(0, 0, 0, 0.45); margin-bottom: 8px;">
                            No products found
                        </div>
                        <div style="font-size: 14px; color: rgba(0, 0, 0, 0.25);">
                            Try adjusting your filters or search terms
                        </div>
                    </div>
                `;
                return;
            }
            
            const start = (currentPage - 1) * productsPerPage;
            const end = start + productsPerPage;
            const pageProducts = filteredProducts.slice(start, end);
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 24px;">
                    ${pageProducts.map(product => `
                        <div class="product-card" style="border: 1px solid #f0f0f0; border-radius: 8px; padding: 16px; transition: all 0.3s; cursor: pointer;"
                             onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.15)'; this.style.borderColor='#1677ff';"
                             onmouseout="this.style.boxShadow='none'; this.style.borderColor='#f0f0f0';"
                             onclick="window.location.href='/product/${product.sku}'">
                            <div class="product-image-container">
                                <img src="${product.image || '/images/placeholder.png'}" 
                                     alt="${product.title || 'Product'}" 
                                     class="product-image"
                                     onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22280%22 height=%22280%22%3E%3Crect fill=%22%23fafafa%22 width=%22280%22 height=%22280%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22 font-size=%2214%22%3ENo Image%3C/text%3E%3C/svg%3E'">
                            </div>
                            <div class="product-title">${product.title || 'Product'}</div>
                            <div class="product-price">$${(product.price || 0).toFixed(2)}</div>
                            <div class="product-actions">
                                <button onclick="event.stopPropagation(); addToCart('${product.sku}')" 
                                        style="width: 100%; padding: 8px 16px; background: #1677ff; color: #ffffff; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s;"
                                        onmouseover="this.style.background='#4096ff'"
                                        onmouseout="this.style.background='#1677ff'">
                                    Add to Cart
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // Render pagination
        function renderPagination() {
            const container = document.getElementById('paginationContainer');
            const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
            
            if (totalPages <= 1) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            
            let paginationHTML = '<div style="display: flex; justify-content: center; align-items: center; gap: 8px;">';
            
            // Previous button
            paginationHTML += `
                <button onclick="changePage(${currentPage - 1})" 
                        ${currentPage === 1 ? 'disabled' : ''}
                        style="padding: 8px 16px; border: 1px solid #d9d9d9; border-radius: 6px; background: #ffffff; cursor: ${currentPage === 1 ? 'not-allowed' : 'pointer'}; opacity: ${currentPage === 1 ? 0.5 : 1};">
                    Previous
                </button>
            `;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `
                        <button onclick="changePage(${i})" 
                                style="padding: 8px 12px; border: 1px solid ${i === currentPage ? '#1677ff' : '#d9d9d9'}; border-radius: 6px; background: ${i === currentPage ? '#1677ff' : '#ffffff'}; color: ${i === currentPage ? '#ffffff' : 'rgba(0,0,0,0.88)'}; cursor: pointer; font-weight: ${i === currentPage ? '600' : '400'};">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += '<span style="padding: 0 4px;">...</span>';
                }
            }
            
            // Next button
            paginationHTML += `
                <button onclick="changePage(${currentPage + 1})" 
                        ${currentPage === totalPages ? 'disabled' : ''}
                        style="padding: 8px 16px; border: 1px solid #d9d9d9; border-radius: 6px; background: #ffffff; cursor: ${currentPage === totalPages ? 'not-allowed' : 'pointer'}; opacity: ${currentPage === totalPages ? 0.5 : 1};">
                    Next
                </button>
            `;
            
            paginationHTML += '</div>';
            container.innerHTML = paginationHTML;
        }
        
        // Filter by category
        function filterByCategory(category) {
            currentCategory = category;
            currentPage = 1;
            
            // Update active state
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            filterProducts();
        }
        
        // Handle search
        function handleSearch(query) {
            searchQuery = query;
            currentPage = 1;
            filterProducts();
        }
        
        // Handle sort
        function handleSort(sort) {
            currentSort = sort;
            sortProducts();
            renderProducts();
        }
        
        // Change page
        function changePage(page) {
            const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderProducts();
            renderPagination();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Add to cart
        function addToCart(sku) {
            if (typeof addItemToCart === 'function') {
                addItemToCart(sku, 1);
                updateCartCount();
                
                // Show success message (using Ant Design notification if available)
                if (window.antd && window.antd.message) {
                    window.antd.message.success('Product added to cart!');
                } else {
                    alert('Product added to cart!');
                }
            } else {
                console.error('addItemToCart function not found');
            }
        }
        
        // Update cart count
        function updateCartCount() {
            if (typeof getCartItemCount === 'function') {
                const count = getCartItemCount();
                const cartEl = document.getElementById('cartCount');
                if (cartEl) {
                    cartEl.textContent = `Cart (${count})`;
                }
            }
        }
        
        // Initialize on load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>