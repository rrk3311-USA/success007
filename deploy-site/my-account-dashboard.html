<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account - Success Chemistry</title>
    <meta name="description" content="Manage your account, view orders, track loyalty points, and manage subscriptions.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&family=Poppins:wght@400;500;600&family=Inter:wght@400;500;600&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/includes/universal-header.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
            position: absolute;
            right: 20px;
        }

        .nav-links a {
            text-decoration: none;
            color: #0a234e;
            font-weight: 600;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #667eea;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }

        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .dashboard-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .sidebar {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 5px;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border-radius: 12px;
            text-decoration: none;
            color: #333;
            font-weight: 600;
            transition: all 0.3s;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .sidebar-nav .icon {
            font-size: 1.3rem;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            min-height: 600px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-size: 2rem;
            color: #0a234e;
            margin-bottom: 30px;
            font-weight: 700;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9ff, #fff5f8);
            border: 2px solid #e9ecef;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #0a234e;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: #666;
            font-weight: 600;
        }

        .order-list {
            margin-top: 30px;
        }

        .order-item {
            border: 2px solid #e9ecef;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .order-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.1);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .order-number {
            font-weight: 700;
            color: #0a234e;
            font-size: 1.1rem;
        }

        .order-status {
            padding: 6px 16px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .order-status.completed {
            background: #d4edda;
            color: #155724;
        }

        .order-status.processing {
            background: #fff3cd;
            color: #856404;
        }

        .order-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .order-detail {
            font-size: 0.95rem;
        }

        .order-detail strong {
            display: block;
            color: #666;
            margin-bottom: 5px;
        }

        .btn {
            display: inline-block;
            padding: 12px 30px;
            border-radius: 999px;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e9ecef;
            color: #333;
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            color: #666;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #0a234e;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .subscription-card {
            border: 2px solid #667eea;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea05, #764ba205);
        }

        .subscription-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .subscription-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0a234e;
        }

        .subscription-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 6px 16px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .subscription-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .subscription-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
            }

            .sidebar-nav {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }
        }

        @media (max-width: 768px) {
            .dashboard-header h1 {
                font-size: 2rem;
            }

            .main-content {
                padding: 25px;
            }

            .order-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Universal Header -->
    <div class="header-wrapper">
        <div class="topbar">
            <div class="container">
                <div class="topbar-inner">
                    <a class="brand" href="/">
                        <img src="/public/images/SC_logo_withR.png" alt="Success Chemistry">
                    </a>
                    <a href="/my-account-dashboard.html" class="account-link">
                        <span>üë§</span>
                        <span>My Account</span>
                    </a>
                </div>
            </div>
        </div>
        <div class="header-divider"></div>
        <div class="blue-nav">
            <div class="container">
                <a href="/">Home</a>
                <a href="/blog">Articles</a>
                <a href="/shop">üß™ Shop</a>
                <a href="/cart" id="cartLink">Cart üõí <span id="navCartCount">0</span></a>
                <a href="/contact">Contact</a>
            </div>
        </div>
        <div class="header-divider"></div>
    </div>

    <!-- Dashboard -->
    <div class="container">
        <div class="dashboard-header">
            <h1>Welcome back, <span id="customerName">Customer</span>!</h1>
            <p>Manage your orders, loyalty points, subscriptions, and account settings</p>
        </div>

        <div class="dashboard-grid">
            <!-- Sidebar Navigation -->
            <div class="sidebar">
                <ul class="sidebar-nav">
                    <li><a href="#" class="nav-link active" data-section="overview"><span class="icon">üìä</span> Overview</a></li>
                    <li><a href="#" class="nav-link" data-section="loyalty"><span class="icon">‚≠ê</span> Loyalty Points</a></li>
                    <li><a href="#" class="nav-link" data-section="orders"><span class="icon">üì¶</span> Order History</a></li>
                    <li><a href="#" class="nav-link" data-section="subscriptions"><span class="icon">üîÑ</span> Subscriptions</a></li>
                    <li><a href="#" class="nav-link" data-section="settings"><span class="icon">‚öôÔ∏è</span> Account Settings</a></li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Overview Section -->
                <div class="section active" id="overview">
                    <h2 class="section-title">Account Overview</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">‚≠ê</div>
                            <div class="stat-value" id="overviewPoints">0</div>
                            <div class="stat-label">Loyalty Points</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üì¶</div>
                            <div class="stat-value" id="overviewOrders">0</div>
                            <div class="stat-label">Total Orders</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üîÑ</div>
                            <div class="stat-value" id="overviewSubscriptions">0</div>
                            <div class="stat-label">Active Subscriptions</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-value" id="overviewSpent">$0</div>
                            <div class="stat-label">Total Spent</div>
                        </div>
                    </div>

                    <h3 style="margin-bottom: 20px; color: #0a234e;">Recent Orders</h3>
                    <div id="recentOrders"></div>
                </div>

                <!-- Loyalty Points Section -->
                <div class="section" id="loyalty">
                    <h2 class="section-title">‚≠ê Loyalty Rewards</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">‚≠ê</div>
                            <div class="stat-value" id="loyaltyPoints">0</div>
                            <div class="stat-label">Available Points</div>
                            <p style="margin-top: 10px; color: #667eea; font-weight: 700;" id="loyaltyValue">Worth $0.00</p>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üéâ</div>
                            <div class="stat-value" id="loyaltyEarned">0</div>
                            <div class="stat-label">Total Earned</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üéÅ</div>
                            <div class="stat-value" id="loyaltyRedeemed">0</div>
                            <div class="stat-label">Total Redeemed</div>
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, #667eea10, #764ba210); border-radius: 16px; padding: 30px; margin: 30px 0;">
                        <h3 style="color: #0a234e; margin-bottom: 15px;">How It Works</h3>
                        <p style="font-size: 1.1rem; margin-bottom: 15px;">Earn <strong>5 points for every $1</strong> you spend!</p>
                        <p style="color: #666;">Redeem 100 points for $1 off your next order. Minimum 500 points to redeem.</p>
                    </div>

                    <a href="/loyalty-dashboard.html" class="btn btn-primary">View Full Loyalty Dashboard ‚Üí</a>
                </div>

                <!-- Orders Section -->
                <div class="section" id="orders">
                    <h2 class="section-title">üì¶ Order History</h2>
                    <div class="order-list" id="ordersList"></div>
                </div>

                <!-- Subscriptions Section -->
                <div class="section" id="subscriptions">
                    <h2 class="section-title">üîÑ My Subscriptions</h2>
                    <div id="subscriptionsList"></div>
                </div>

                <!-- Settings Section -->
                <div class="section" id="settings">
                    <h2 class="section-title">‚öôÔ∏è Account Settings</h2>
                    
                    <form id="settingsForm">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="fullName" placeholder="John Doe">
                        </div>
                        
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" id="email" placeholder="john@example.com">
                        </div>
                        
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="phone" placeholder="(555) 123-4567">
                        </div>
                        
                        <div class="form-group">
                            <label>Shipping Address</label>
                            <textarea id="address" rows="3" placeholder="123 Main St, City, State ZIP"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/config.js"></script>
    <script src="/loyalty-points.js"></script>
    <script src="/tracking.js"></script>
    <script src="/public/woocommerce-account.js"></script>

    <script>
        // Global account data
        let accountData = {
            customer: null,
            orders: []
        };

        // Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Update active nav
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Show section
                const sectionId = this.getAttribute('data-section');
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(sectionId).classList.add('active');
                
                // Load section data
                loadSectionData(sectionId);
            });
        });

        // Load section data
        function loadSectionData(section) {
            switch(section) {
                case 'overview':
                    loadOverview();
                    break;
                case 'loyalty':
                    loadLoyalty();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'subscriptions':
                    loadSubscriptions();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        // Load account data from WooCommerce
        async function loadAccountData() {
            const container = document.getElementById('recentOrders');
            container.innerHTML = '<div style="text-align: center; padding: 40px;"><p>Loading account data...</p></div>';
            
            try {
                // Initialize WooCommerce API
                window.WooCommerceAccount.init();
                
                // Load customer account (will try to get email from localStorage)
                accountData = await window.WooCommerceAccount.loadCustomerAccount();
                
                if (!accountData || !accountData.customer) {
                    // Customer not found in WooCommerce - show message
                    const email = window.WooCommerceAccount.getCustomerEmail();
                    if (email) {
                        container.innerHTML = `<div class="empty-state">
                            <div class="empty-state-icon">üë§</div>
                            <h3>Account Not Found</h3>
                            <p>We couldn't find an account for ${email} in our system.</p>
                            <p style="margin-top: 10px;">Please complete an order first, or contact support if you believe this is an error.</p>
                            <a href="/shop" class="btn btn-primary" style="margin-top: 20px;">Start Shopping</a>
                        </div>`;
                    } else {
                        container.innerHTML = `<div class="empty-state">
                            <div class="empty-state-icon">üë§</div>
                            <h3>Welcome!</h3>
                            <p>To view your account, please complete an order first or provide your email address.</p>
                            <a href="/shop" class="btn btn-primary" style="margin-top: 20px;">Start Shopping</a>
                        </div>`;
                    }
                    return;
                }
                
                // Update customer name
                const customerName = accountData.customer.first_name && accountData.customer.last_name
                    ? `${accountData.customer.first_name} ${accountData.customer.last_name}`
                    : accountData.customer.username || accountData.customer.email || 'Customer';
                document.getElementById('customerName').textContent = customerName;
                
                // Load overview
                loadOverview();
                
            } catch (error) {
                console.error('Failed to load account data:', error);
                container.innerHTML = `<div class="empty-state">
                    <div class="empty-state-icon">‚ö†Ô∏è</div>
                    <h3>Error Loading Account</h3>
                    <p>${error.message}</p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">Make sure WooCommerce API credentials are configured in admin settings.</p>
                </div>`;
            }
        }

        // Load overview
        function loadOverview() {
            if (!accountData.customer) {
                loadAccountData();
                return;
            }
            
            const loyaltyData = window.LoyaltyPoints?.getData();
            const orders = accountData.orders || [];
            
            document.getElementById('overviewPoints').textContent = loyaltyData?.points.toLocaleString() || '0';
            document.getElementById('overviewOrders').textContent = orders.length;
            document.getElementById('overviewSubscriptions').textContent = '0';
            
            const totalSpent = orders.reduce((sum, order) => sum + (parseFloat(order.total) || 0), 0);
            document.getElementById('overviewSpent').textContent = '$' + totalSpent.toFixed(2);
            
            // Recent orders
            const recentContainer = document.getElementById('recentOrders');
            const recentOrders = orders.slice(0, 3);
            
            if (recentOrders.length === 0) {
                recentContainer.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì¶</div><h3>No orders yet</h3><p>Start shopping to see your orders here!</p><a href="/shop" class="btn btn-primary" style="margin-top: 20px;">Shop Now</a></div>';
            } else {
                recentContainer.innerHTML = recentOrders.map(order => createWooOrderHTML(order)).join('');
            }
        }

        // Load loyalty
        function loadLoyalty() {
            const data = window.LoyaltyPoints?.getData();
            if (!data) {
                document.getElementById('loyaltyPoints').textContent = '0';
                document.getElementById('loyaltyEarned').textContent = '0';
                document.getElementById('loyaltyRedeemed').textContent = '0';
                document.getElementById('loyaltyValue').textContent = 'Worth $0.00';
                return;
            }
            
            document.getElementById('loyaltyPoints').textContent = data.points.toLocaleString();
            document.getElementById('loyaltyEarned').textContent = data.totalEarned.toLocaleString();
            document.getElementById('loyaltyRedeemed').textContent = data.totalRedeemed.toLocaleString();
            
            const dollarValue = window.LoyaltyPoints.pointsToDollars(data.points);
            document.getElementById('loyaltyValue').textContent = `Worth $${dollarValue}`;
        }

        // Load orders from WooCommerce
        async function loadOrders() {
            const container = document.getElementById('ordersList');
            container.innerHTML = '<div style="text-align: center; padding: 40px;"><p>Loading orders...</p></div>';
            
            try {
                if (!accountData.customer) {
                    await loadAccountData();
                }
                
                const orders = accountData.orders || [];
                
                if (orders.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì¶</div><h3>No orders yet</h3><p>Your order history will appear here once you make a purchase.</p><a href="/shop" class="btn btn-primary" style="margin-top: 20px;">Start Shopping</a></div>';
                } else {
                    container.innerHTML = orders.map(order => createWooOrderHTML(order)).join('');
                }
            } catch (error) {
                console.error('Failed to load orders:', error);
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ö†Ô∏è</div><h3>Error Loading Orders</h3><p>${error.message}</p></div>`;
            }
        }

        // Create WooCommerce order HTML
        function createWooOrderHTML(order) {
            const date = new Date(order.date_created).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            const itemCount = order.line_items ? order.line_items.length : 0;
            const status = order.status || 'pending';
            const statusClass = status === 'completed' ? 'completed' : 
                               status === 'processing' ? 'processing' : 'pending';
            
            return `
                <div class="order-item">
                    <div class="order-header">
                        <div class="order-number">Order #${order.number || order.id}</div>
                        <div class="order-status ${statusClass}">${status.toUpperCase()}</div>
                    </div>
                    <div class="order-details">
                        <div class="order-detail">
                            <strong>Date</strong>
                            ${date}
                        </div>
                        <div class="order-detail">
                            <strong>Total</strong>
                            $${parseFloat(order.total || 0).toFixed(2)}
                        </div>
                        <div class="order-detail">
                            <strong>Items</strong>
                            ${itemCount} item(s)
                        </div>
                        <div class="order-detail">
                            <strong>Payment</strong>
                            ${order.payment_method_title || order.payment_method || 'N/A'}
                        </div>
                    </div>
                    ${order.line_items && order.line_items.length > 0 ? `
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                            <strong style="display: block; margin-bottom: 10px; color: #666;">Items:</strong>
                            ${order.line_items.map(item => `
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem;">
                                    <span>${item.name} x${item.quantity}</span>
                                    <span>$${parseFloat(item.total || 0).toFixed(2)}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Load subscriptions
        function loadSubscriptions() {
            const container = document.getElementById('subscriptionsList');
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîÑ</div><h3>No active subscriptions</h3><p>Subscribe to the Rainbow Subscription and get custom products every 2 months!</p><a href="/subscribe.html" class="btn btn-primary" style="margin-top: 20px;">View Subscription Options</a></div>';
        }

        // Load settings from WooCommerce customer data
        function loadSettings() {
            if (!accountData.customer) {
                loadAccountData();
                return;
            }
            
            const customer = accountData.customer;
            
            document.getElementById('fullName').value = 
                customer.first_name && customer.last_name 
                    ? `${customer.first_name} ${customer.last_name}`
                    : customer.username || '';
            document.getElementById('email').value = customer.email || '';
            document.getElementById('phone').value = customer.billing?.phone || '';
            
            // Format address
            const billing = customer.billing;
            if (billing) {
                const addressParts = [
                    billing.address_1,
                    billing.address_2,
                    billing.city,
                    billing.state,
                    billing.postcode,
                    billing.country
                ].filter(Boolean);
                document.getElementById('address').value = addressParts.join(', ');
            }
        }

        // Save settings to WooCommerce
        document.getElementById('settingsForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!accountData.customer) {
                alert('‚ö†Ô∏è Please load your account first');
                return;
            }
            
            const fullName = document.getElementById('fullName').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const address = document.getElementById('address').value.trim();
            
            // Parse name
            const nameParts = fullName.split(' ');
            const firstName = nameParts[0] || '';
            const lastName = nameParts.slice(1).join(' ') || '';
            
            // Parse address (simple parsing)
            const addressParts = address.split(',').map(s => s.trim());
            
            try {
                const updateData = {
                    first_name: firstName,
                    last_name: lastName,
                    email: email,
                    billing: {
                        first_name: firstName,
                        last_name: lastName,
                        email: email,
                        phone: phone,
                        address_1: addressParts[0] || '',
                        city: addressParts[addressParts.length - 3] || '',
                        state: addressParts[addressParts.length - 2] || '',
                        postcode: addressParts[addressParts.length - 1] || '',
                        country: 'US'
                    }
                };
                
                const updatedCustomer = await window.WooCommerceAccount.updateCustomer(
                    accountData.customer.id,
                    updateData
                );
                
                // Update local data
                accountData.customer = updatedCustomer;
                window.WooCommerceAccount.setCurrentCustomer(updatedCustomer);
                
                // Update display
                document.getElementById('customerName').textContent = fullName || email || 'Customer';
                
                alert('‚úÖ Settings saved successfully!');
            } catch (error) {
                console.error('Failed to save settings:', error);
                alert('‚ùå Failed to save settings: ' + error.message);
            }
        });

        // Update cart count
        function updateCartCount() {
            try {
                const cart = localStorage.getItem('cart');
                if (cart) {
                    const cartData = JSON.parse(cart);
                    const count = cartData.reduce((sum, item) => sum + (parseInt(item.quantity) || 0), 0);
                    const cartCountEl = document.getElementById('navCartCount');
                    if (cartCountEl) {
                        cartCountEl.textContent = count;
                    }
                }
            } catch (e) {
                console.error('Error updating cart count:', e);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
            loadAccountData();
            
            // Listen for cart updates
            window.addEventListener('storage', function(e) {
                if (e.key === 'cart') {
                    updateCartCount();
                }
            });
        });
    </script>

    <!-- Footer -->
    <footer class="footer" style="margin-top: 60px;">
        <style>

            100% { background-position: 200% 50%; }
        }

            100% { background-position: 200% 50%; }
        }

        @media (max-width: 768px) 

        @media (max-width: 520px) 
    
        .topbar-inner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 0;
        }

        .header-divider {
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #667eea 100%);
            background-size: 200% 100%;
            animation: gradientMove 3s linear infinite;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .brand {
            display: inline-flex;
            align-items: center;
            text-decoration: none;
        }

        .brand img {
            height: 58px;
        }

        .topbar {
            background: white;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: none;
            padding: 22px 0;
            margin-top: 8px;
        }

        .blue-nav {
            background: #2854a6;
            padding: 18px 0;
        }

        .blue-nav .container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 48px;
            flex-wrap: wrap;
        }

        .blue-nav a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
            font-size: 1.56rem;
            letter-spacing: 0.2px;
            transition: opacity 0.3s;
        }

        .blue-nav a:hover {
            opacity: 0.8;
        }

        .footer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }

        .footer-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
        }

        @media (max-width: 768px) {
            .topbar-inner {
                padding: 12px 0;
            }

            .brand img {
                height: 44px;
            }

            .blue-nav {
                padding: 10px 0;
            }

            .blue-nav .container {
                gap: 22px;
            }

            .blue-nav a {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 520px) {
            .blue-nav .container {
                gap: 16px;
            }

            .blue-nav a {
                font-size: 1.15rem;
            }
        }

        @media (max-width: 768px) {
            

            .brand img {
                height: 44px;
            }

            .blue-nav .container {
                gap: 22px;
            }

            .blue-nav a {
                font-size: 1.2rem;
            }
        }

            .blue-nav a {
                font-size: 1.15rem;
            }
        }

        @media (max-width: 768px) {

            .brand img {
                height: 44px;
            }

            .blue-nav .container {
                gap: 22px;
            }

            .blue-nav a {
                font-size: 1.2rem;
            }
        }

            .blue-nav a {
                font-size: 1.15rem;
            }
        }
    </style>
        <div style="background: #2854a6; padding: 20px; text-align: center;">
            <div style="display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;">
                <a href="/shop" class="footer-btn" style="background: white; color: #2854a6; padding: 14px 32px; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; border-radius: 50px; border: 3px solid transparent; background-image: linear-gradient(white, white), linear-gradient(135deg, #5eead4 0%, #3b82f6 50%, #8b5cf6 100%); background-origin: border-box; background-clip: padding-box, border-box; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2); cursor: pointer; text-decoration: none; transition: all 0.3s ease; display: inline-block;">VIEW ALL</a>
                <a href="/cart" class="footer-btn" style="background: white; color: #2854a6; padding: 14px 32px; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; border-radius: 50px; border: 3px solid transparent; background-image: linear-gradient(white, white), linear-gradient(135deg, #5eead4 0%, #3b82f6 50%, #8b5cf6 100%); background-origin: border-box; background-clip: padding-box, border-box; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2); cursor: pointer; text-decoration: none; transition: all 0.3s ease; display: inline-block;">VIEW CART</a>
            </div>
            <div style="display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                <img src="/public/images/Footer-Badges-.png" alt="Certification Badges" style="max-width: 350px; height: auto;">
            </div>
        </div>
        <div style="width: 100%; height: 3px; background: linear-gradient(90deg, #4fd0ff 0%, #ffd34d 50%, #4fd0ff 100%);"></div>
        <div style="background: #2854a6; padding: 15px 20px; display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: wrap; font-size: 0.85rem;">
            <a href="/terms-of-service.html" style="color: white; text-decoration: none; font-weight: 500; transition: opacity 0.3s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">Terms of Service</a>
            <span style="color: rgba(255,255,255,0.3);">|</span>
            <a href="/shipping-returns.html" style="color: white; text-decoration: none; font-weight: 500; transition: opacity 0.3s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">Shipping & Returns</a>
            <span style="color: rgba(255,255,255,0.3);">|</span>
            <a href="/payment-policy.html" style="color: white; text-decoration: none; font-weight: 500; transition: opacity 0.3s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">Payment Policy</a>
            <span style="color: rgba(255,255,255,0.3);">|</span>
            <a href="/privacy-policy.html" style="color: white; text-decoration: none; font-weight: 500; transition: opacity 0.3s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">Privacy Policy</a>
            <span style="color: rgba(255,255,255,0.3);">|</span>
            <a href="/contact" style="color: white; text-decoration: none; font-weight: 500; transition: opacity 0.3s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">Contact</a>
            <span style="color: rgba(255,255,255,0.3);">|</span>
            <a href="/shop" style="color: white; text-decoration: none; font-weight: 500; transition: opacity 0.3s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">üß™ SHOP</a>
        </div>
        <div style="width: 100%; height: 3px; background: linear-gradient(90deg, #4fd0ff 0%, #ffd34d 50%, #4fd0ff 100%);"></div>
                <div style="text-align: center; padding: 16px; background: #2854a6;">
            <p style="color: white; font-size: 0.85rem; margin: 0 0 12px 0;">üóΩ Copyright 2026 - Success Chemistry¬Æ</p>
            <div style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: wrap; margin-top: 12px;">
                <span style="color: rgba(255,255,255,0.7); font-size: 0.8rem;">Powered by:</span>
                <a href="https://cursor.sh" target="_blank" rel="noopener" style="display: inline-flex; align-items: center; gap: 6px; color: white; text-decoration: none; opacity: 0.85; transition: opacity 0.3s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.85'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor"/>
                        <path d="M2 17L12 22L22 17V12L12 17L2 12V17Z" fill="currentColor"/>
                    </svg>
                    <span style="font-size: 0.85rem; font-weight: 500;">Cursor</span>
                </a>
                <a href="https://nvidia.com" target="_blank" rel="noopener" style="display: inline-flex; align-items: center; gap: 6px; color: white; text-decoration: none; opacity: 0.85; transition: opacity 0.3s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.85'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                        <path d="M8.5 6L15.5 6L12 18L8.5 6Z" fill="currentColor"/>
                    </svg>
                    <span style="font-size: 0.85rem; font-weight: 500;">NVIDIA</span>
                </a>
                <a href="https://vercel.com" target="_blank" rel="noopener" style="display: inline-flex; align-items: center; gap: 6px; color: white; text-decoration: none; opacity: 0.85; transition: opacity 0.3s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.85'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor"/>
                        <path d="M2 17L12 22L22 17V12L12 17L2 12V17Z" fill="currentColor"/>
                    </svg>
                    <span style="font-size: 0.85rem; font-weight: 500;">Vercel</span>
                </a>
                <a href="https://github.com" target="_blank" rel="noopener" style="display: inline-flex; align-items: center; gap: 6px; color: white; text-decoration: none; opacity: 0.85; transition: opacity 0.3s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.85'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                        <path d="M12 2C6.477 2 2 6.477 2 12C2 16.42 4.865 20.17 8.839 21.49C9.339 21.58 9.521 21.27 9.521 21.01C9.521 20.77 9.513 20.04 9.508 19.21C6.726 19.76 6.14 17.56 6.14 17.56C5.685 16.33 5.029 16.01 5.029 16.01C4.121 15.33 5.097 15.35 5.097 15.35C6.101 15.43 6.629 16.38 6.629 16.38C7.521 17.82 8.97 17.41 9.539 17.18C9.631 16.54 9.889 16.11 10.176 15.87C7.954 15.64 5.62 14.81 5.62 11.5C5.62 10.39 6.01 9.5 6.649 8.79C6.546 8.54 6.203 7.5 6.747 6.15C6.747 6.15 7.586 5.88 9.496 7.17C10.295 6.95 11.15 6.84 12 6.84C12.85 6.84 13.705 6.95 14.504 7.17C16.414 5.88 17.253 6.15 17.253 6.15C17.797 7.5 17.454 8.54 17.351 8.79C17.99 9.5 18.38 10.39 18.38 11.5C18.38 14.82 16.046 15.64 13.824 15.87C14.174 16.2 14.485 16.78 14.485 17.65C14.485 18.98 14.473 20.04 14.479 21.01C14.479 21.28 14.66 21.59 15.16 21.49C19.135 20.17 22 16.42 22 12C22 6.477 17.523 2 12 2Z" fill="currentColor"/>
                    </svg>
                    <span style="font-size: 0.85rem; font-weight: 500;">GitHub</span>
                </a>
                <a href="https://nodejs.org" target="_blank" rel="noopener" style="display: inline-flex; align-items: center; gap: 6px; color: white; text-decoration: none; opacity: 0.85; transition: opacity 0.3s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.85'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17.5C13 17.78 12.78 18 12.5 18C12.22 18 12 17.78 12 17.5V15.5C12 15.22 12.22 15 12.5 15C12.78 15 13 15.22 13 15.5V17.5ZM16.5 15.5C16.5 15.78 16.28 16 16 16C15.72 16 15.5 15.78 15.5 15.5V13.5C15.5 13.22 15.72 13 16 13C16.28 13 16.5 13.22 16.5 13.5V15.5Z" fill="currentColor"/>
                    </svg>
                    <span style="font-size: 0.85rem; font-weight: 500;">Node.js</span>
                </a>
            </div>
        </div>
    </footer>
</body>
</html>
